<div data-ng-controller="ShipmentDetailsCtrl">
    <div id="shipmentDetailsDialogDiv" data-pls-modal="shipmentDetailsModel.showShipmentDetailsDialog" data-close="closeShipmentDetails()"
         class="modalWidth12 modalHeight7 a_detailsDialog" data-options="shipmentDetailsModel.shipmentDetailsModalOptions">

        <div class="modal-header">
            <div class="row-fluid form-inline controls label-middle">
                <h4 class="span2">Shipment Details</h4>

                <div class="span6">
                    <div class="control-group row-fluid" data-ng-if="shipmentDetailsModel.shipment">
                        <br/>
                        <span class="span1 label-middle customer-label">Customer:</span>

                        <div class="span5">
                            <div data-pls-customer-lookup="shipmentDetailsModel.selectedCustomer"
                                 data-customer-disabled="true">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-body" data-ng-if="shipmentDetailsModel.showShipmentDetailsDialog">
            <div class="row-fluid">
                <div class="span2 form-vertical">
                    <div class="row-fluid">
                        <div class="span3">
                            <label for="bolSpan" class="control-label text-warning">BOL:</label>
                        </div>
                        <div class="span9">
                            <div class="controls wrap">
                                <span id="bolSpan" data-ng-bind="shipmentDetailsModel.shipment.bolNumber"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span3">
                            <label for="soSpan" class="control-label text-warning">SO #:</label>
                        </div>
                        <div class="span9">
                            <div class="controls wrap">
                                <span id="soSpan" data-ng-bind="shipmentDetailsModel.shipment.finishOrder.soNumber"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span3">
                            <label for="proSpan" class="control-label text-warning">Pro #:</label>
                        </div>
                        <div class="span9">
                            <div class="controls wrap">
                                <span id="proSpan" data-ng-bind="shipmentDetailsModel.shipment.proNumber"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="span2 form-vertical">
                    <div class="row-fluid">
                        <div class="span6">
                            <label for="refSpan" class="control-label text-warning">Shipper Ref #:</label>
                        </div>
                        <div class="span6">
                            <div class="controls wrap">
                                <span id="refSpan" data-ng-bind="shipmentDetailsModel.shipment.finishOrder.ref"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span6">
                            <label for="poSpan" class="control-label text-warning">PO #:</label>
                        </div>
                        <div class="span6">
                            <div class="controls wrap">
                                <span id="poSpan" data-ng-bind="shipmentDetailsModel.shipment.finishOrder.poNumber"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span6">
                            <label for="puSpan" class="control-label text-warning">PU #:</label>
                        </div>
                        <div class="span6">
                            <div class="controls wrap">
                                <span id="puSpan" data-ng-bind="shipmentDetailsModel.shipment.finishOrder.puNumber"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="span2 form-vertical">
                    <div class="row-fluid">
                        <div class="span4">
                            <label for="trailerSpan" class="control-label text-warning">Trailer #:</label>
                        </div>
                        <div class="span8">
                            <div class="controls wrap">
                                <span id="trailerSpan" data-ng-bind="shipmentDetailsModel.shipment.finishOrder.trailerNumber"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span4">
                            <label for="glSpan" class="control-label text-warning">GL #:</label>
                        </div>
                        <div class="span8">
                            <div class="controls wrap">
                                <span id="glSpan" data-ng-bind="shipmentDetailsModel.shipment.finishOrder.glNumber"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span4">
                            <label for="cargoValue" class="control-label text-warning">Cargo Value:</label>
                        </div>
                        <div class="span8">
                            <div class="controls wrap">
                                <span id="cargoValue" data-ng-bind="shipmentDetailsModel.shipment.cargoValue"></span>
                                <span data-ng-bind="shipmentDetailsModel.shipment.selectedProposition.carrier.currencyCode"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="span4 form-vertical">
                    <div class="row-fluid">
                        <div class="span3">
                            <label for="originSpan" class="control-label text-warning">Origin:</label>
                        </div>
                        <div class="span9">
                            <div class="controls">
                                <span id="originSpan" data-ng-bind="shipmentDetailsModel.shipment.originDetails.address.zip | zip"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span3">
                            <label for="destinationSpan" class="control-label text-warning">Destination:</label>
                        </div>
                        <div class="span9">
                            <div class="controls">
                                <span id="destinationSpan" data-ng-bind="shipmentDetailsModel.shipment.destinationDetails.address.zip | zip"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span3">
                            <label for="carrierSpan" class="control-label text-warning">Carrier:</label>
                        </div>
                        <div class="span9">
                            <div class="controls">
                                <span id="carrierSpan" data-ng-bind="shipmentDetailsModel.shipment.selectedProposition.carrier.name"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="span2 form-vertical">
                    <div class="row-fluid">
                        <div class="span5">
                            <label for="estimatedDateSpan" class="control-label text-warning">
                                {{shipmentDetailsModel.shipment.status === 'DELIVERED' ? 'Del.Date:' : 'Est.Delivery:'}}
                            </label>
                        </div>
                        <div class="span7">
                            <div class="controls">
                        <span id="estimatedDateSpan"
                              data-ng-bind="shipmentDetailsModel.shipment.status === 'DELIVERED' ?
                              shipmentDetailsModel.shipment.finishOrder.actualDeliveryDate :
                              _.isUndefined(shipmentDetailsModel.shipment.finishOrder.estimatedDelivery) ?
                              'N/A' : shipmentDetailsModel.shipment.finishOrder.estimatedDelivery | date:wideAppDateFormat">
                        </span>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span5">
                            <label for="statusSpan" class="control-label text-warning">Status:</label>
                        </div>
                        <div class="span7">
                            <div class="controls">
                                <span data-ng-bind="shipmentDetailsModel.shipment.status | shipmentStatus" id="statusSpan"
                                      class="text-success"></span>
                            </div>
                        </div>
                    </div>

                    <div data-ng-if="!shipmentDetailsModel.shipment.isManualBol">
                        <div class="row-fluid" >
                            <div class="span5">
                                <label for="totalSpan" class="control-label text-warning">Total:</label>
                            </div>

                            <div class="span7">
                                <div class="controls">
                                <span id="totalSpan" class="text-success" data-ng-if="$root.isPlsPermissions('VIEW_PLS_CUSTOMER_COST
                                        && !(EDIT_PLS_REVENUE || EDIT_CARRIER_COST || VIEW_PLS_REVENUE_AND_CARRIER_COST)')"
                                      data-ng-bind="getTotalCost() | plsCurrency">
                                </span>

                                <span class="text-success" data-ng-if="$root.isFieldRequired('EDIT_PLS_REVENUE') ||
                                         $root.isFieldRequired('EDIT_CARRIER_COST') || $root.isFieldRequired('VIEW_PLS_REVENUE_AND_CARRIER_COST')">
                                    <span id="totalSpan" class="text-success" data-ng-bind="getTotalCost() | plsCurrency"></span>&nbsp;/&nbsp;
                                    <span class="text-success" data-ng-bind="getCarrierTotalCost() | plsCurrency"></span>
                                </span>
                                </div>
                            </div>
                        </div>

                        <div data-ng-if="shipmentDetailsModel.shipment.billTo.paymentMethod === 'PREPAID_ONLY'" class="row-fluid">
                            <div data-pls-prepaid-amount data-prepaid-details="shipmentDetailsModel.shipment.prepaidDetails"
                                 data-total-revenue="getTotalCost()" data-type="color" class="span12"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row-fluid">
                <div class="tabbable tabbable-bordered">
                    <ul class="nav nav-tabs">
                        <li data-ng-class="{active:shipmentDetailsModel.selectedTab === 'tracking'}"
                            data-ng-if="!shipmentDetailsModel.shipment.isManualBol">
                            <a data-ng-click="shipmentDetailsModel.selectedTab='tracking'">Tracking</a>
                        </li>
                        <li data-ng-class="{active:shipmentDetailsModel.selectedTab === 'images'}">
                            <a data-ng-click="shipmentDetailsModel.selectedTab='images'">Docs</a>
                        </li>
                        <li data-ng-class="{active:shipmentDetailsModel.selectedTab === 'details'}">
                            <a data-ng-click="shipmentDetailsModel.selectedTab='details'">Details</a>
                        </li>
                        <li data-ng-class="{active:shipmentDetailsModel.selectedTab === 'order'}">
                            <a data-ng-click="shipmentDetailsModel.selectedTab='order'">Order</a>
                        </li>
                    </ul>

                    <div class="tab-content">
                        <div class="tab-pane active">
                            <div data-ng-switch="shipmentDetailsModel.selectedTab">
                                <div data-ng-switch-when="tracking">
                                    <div data-ng-include="'pages/content/quotes/shipmentdetails/shipment-tracking.html'"></div>
                                </div>
                                <div data-ng-switch-when="images">
                                    <div data-ng-if="shipmentDetailsModel.shipment.id" data-ng-include="'pages/content/quotes/shipmentdetails/shipment-images.html'"></div>
                                </div>
                                <div data-ng-switch-when="details">
                                    <div data-ng-include="'pages/content/quotes/shipmentdetails/shipment-specialities.html'"></div>
                                </div>
                                <div data-ng-switch-when="order">
                                    <div data-ng-include="'pages/content/quotes/shipmentdetails/shipment-order.html'"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <div class="row-fluid">
                <div class="span5 text-left">
                    <button type="button" class="btn cancel a_cancelButton" data-ng-click="showConfirmationCancelDialog()"
                            data-ng-if="$root.isFieldRequired('CANCEL_SHIPMENT_BEFORE_DISPATCHED') && !shipmentDetailsModel.shipment.isManualBol"
                            data-ng-disabled="cancelIsDisabled()"
                            data-ng-hide="shipmentDetailsModel.isViewMode || !shipmentDetailsModel.isAvailableCancel">
                        Cancel Shipment
                    </button>
                    <button type="button" class="btn cancel a_cancelButton" data-ng-click="showConfirmationCancelDialog()"
                            data-ng-if="canCancelManualBol() && shipmentDetailsModel.shipment.isManualBol">
                        Cancel Shipment
                    </button>
                </div>
                <div class="span7 text-right">
                    <button type="button" data-ng-click="editShipment()" class="btn a_editOrder"
                            data-ng-if="!shipmentDetailsModel.shipment.isManualBol"
                            data-ng-if="$root.isPlsPermissions('EDIT_SHIPMENT_BEFORE_PICKUP || EDIT_SHIPMENT_AFTER_PICKUP')"
                            data-ng-disabled="!isPermittedToEdit() || shipmentDetailsModel.shipment.invoiceDate"
                            data-ng-hide="shipmentDetailsModel.isViewMode || !$root.isFieldRequired('QUOTES_VIEW') || shipmentDetailsModel.hideEditOrderButton">
                        Edit Shipment...
                    </button>
                    <button type="button" data-ng-click="editManualBol()" class="btn a_editOrder"
                            data-ng-if="$root.isPlsPermissions('EDIT_MANUAL_BOL') && shipmentDetailsModel.shipment.isManualBol">Edit Shipment...
                    </button>

                    <button type="button" class="btn cancel a_copyButton" data-ng-click="copyShipment()"
                            data-ng-if="!shipmentDetailsModel.shipment.isManualBol"
                            data-ng-if="!isCanNotBook"
                            data-ng-hide="shipmentDetailsModel.isViewMode || pageModel.customerInvoices ||
                        !$root.isFieldRequired('QUOTES_VIEW')">Copy Shipment...
                    </button>
                    <button type="button" class="btn cancel a_copyButton" data-ng-click="copyManualBol()"
                            data-ng-if="$root.isFieldRequired('CREATE_MANUAL_BOL') && shipmentDetailsModel.shipment.isManualBol">Copy Shipment...
                    </button>

                    <button type="button" class="btn disabled cancel a_copyButton"
                            data-ng-if="isCanNotBook"
                            data-tooltip="{{$root.authData.organization.statusReason === 'CREDIT_HOLD' ? 'Customer is on Credit Hold' : 'Customer is on Hold for missing Tax ID'}}"
                            data-tooltip-trigger='mouseenter'
                            data-ng-hide="shipmentDetailsModel.isViewMode || pageModel.customerInvoices || !$root.isFieldRequired('QUOTES_VIEW')">Copy
                        Shipment...
                    </button>
                    <button type="button" class="btn cancel btn-primary a_closeButton" data-ng-click="closeShipmentDetails();">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div data-pls-confirm-cancel-order-dialog data-show-confirmation-dialog="showConfirmationDialog"
         data-is-manual-bol="shipmentDetailsModel.isManualBol"
         data-close-handler=cancelShipment() data-shipment-id="shipmentDetailsModel.shipment.id" data-email-handler="showCancelEmailDialog()"
         data-status="shipmentDetailsModel.shipment.status" data-parent-dialog="shipmentDetailsDialogDiv"
         data-api-capable="shipmentDetailsModel.shipment.selectedProposition.carrier.apiCapable"></div>

    <div data-pls-modal="showRedirectNotification" data-close="closeNotification()"
         data-options="shipmentDetailsModel.shipmentRedirectNotificationModalOptions"
         class="modal" data-enter="closeNotification()">

        <div class="modal-header">
            <h4>Redirection</h4>
        </div>

        <div class="modal-body">
            <div class="text-center">Pickup date is in past or empty, you will be redirected to Rate Quote page.</div>
        </div>

        <div class="modal-footer">
            <div class="text-center">
                <button class="btn" type="button" data-ng-click="closeNotification()">OK</button>
            </div>
        </div>
    </div>
    <div data-ng-include="'pages/content/sales-order/so-docs-full-view-dlg.html'"></div>
    <div data-pls-send-mail="emailOptions" data-dialog-show-option="emailOptions.showSendEmailDialog"
         data-modal-options="emailOptions.docSendMailModalOptions"></div>
</div>